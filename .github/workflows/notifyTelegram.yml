name: 'Notify Telegram'

on: workflow_call

jobs:
  notification_logic:
    runs-on: ubuntu-latest
    outputs:
      message: ${{ steps.set_message.outputs.message }}
    steps:
      - name: Set Notification Message
        id: set_message
        run: |
          MESSAGE="Notification: "
          if [ "${{ inputs.event_name }}" == "pull_request" ] && [ "${{ inputs.action }}" == "opened" ]; then
            MESSAGE+="PR #${{ inputs.pr_number }} opened by @${{ inputs.pr_user }} - ${{ inputs.pr_title }}. Check it: ${{ inputs.pr_url }}"
          elif [ "${{ inputs.event_name }}" == "pull_request_review" ] && [ "${{ inputs.review_state }}" == "changes_requested" ]; then
            MESSAGE+="Changes requested on PR #${{ inputs.pr_number }} by @${{ inputs.reviewer_logins }}. Review: ${{ inputs.pr_url }}"
          elif [ "${{ inputs.event_name }}" == "pull_request" ] && [ "${{ inputs.action }}" == "synchronize" ]; then
            MESSAGE+="PR #${{ inputs.pr_number }} updated after changes requested. Review the updates: ${{ inputs.pr_url }}"
          elif [ "${{ inputs.event_name }}" == "pull_request_review" ] && [ "${{ inputs.review_state }}" == "approved" ]; then
            MESSAGE+="PR #${{ inputs.pr_number }} approved by @${{ inputs.reviewer_logins }}. Congratulations! ðŸŽ‰"
          fi
          echo "MESSAGE=$MESSAGE" >> $GITHUB_ENV

          curl -X POST "https://api.telegram.org/bot6972170862:AAG4aN5Z8ApFusuToNIE8-zEe6PoJLOSl3U/sendMessage" \
               -H "Content-Type: application/x-www-form-urlencoded" \
               -d "chat_id=-1002018935905" \
               -d "text=$MESSAGE" \
               -d "parse_mode=Markdown" \
               -d "disable_web_page_preview=true"
